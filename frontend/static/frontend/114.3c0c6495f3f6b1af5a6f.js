"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[114],{114:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var n=a(540),r=a(767),l=a(926),s=a(550),o=a(946);function i(){const[e,t]=(0,n.useState)(null),[a,r]=(0,n.useState)(!1),[i,c]=(0,n.useState)(),[m,d]=(0,n.useState)(null),{user:u,contextLoading:p,modalErrorMessage:h,setModalErrorMessage:g,setSuccessMessage:E,retrieveUserData:w,resetApplicationMessages:v}=(0,o.Xn)();return(0,n.useEffect)((()=>{if(!a)return void c(void 0);const e=new FileReader;e.onload=()=>{const t=new Image;t.onload=()=>{const e=document.createElement("canvas"),n=e.getContext("2d");let r,l,s,o;t.width>t.height?(r=t.height,l=t.height,s=(t.width-t.height)/2,o=0):(r=t.width,l=t.width,o=(t.height-t.width)/2,s=0),e.width=r,e.height=l,n.drawImage(t,s,o,r,l,0,0,r,l);const i=e.toDataURL(a.type);c(i)},t.src=e.result},e.readAsDataURL(a)}),[a]),p?null:n.createElement("div",null,n.createElement("div",{className:"p-3 d-flex justify-content-center"},n.createElement("div",{className:"container"},n.createElement("div",null,n.createElement("strong",{style:{fontSize:"20px"}},"Profile photo")),n.createElement("div",null,""!=u.profile_picture_data&&n.createElement("img",{id:"profile-picture-div",style:{width:"7rem",height:"7rem"},className:"rounded-circle",src:`data: image/${u.profile_picture_format}; base64, ${u.profile_picture_data}`,alt:u.username}))),n.createElement("button",{id:"profile-picture-button",className:"btn btn-outline-secondary rounded-15 align-self-center",onClick:e=>{v(),(0,l.YK)("profile-picture-modal",e)}},"Change"),n.createElement("div",{className:"custom-modal hidden",id:"profile-picture-modal",onClick:e=>{e.stopPropagation()}},n.createElement("div",{className:"custom-modal-header"},n.createElement("h5",null,"Change profile picture"),n.createElement("button",{type:"button",className:"btn btn-link link-no-decorations ms-auto",id:"close-modal"},n.createElement("span",{onClick:e=>{v(),(0,l.tI)(),c(void 0)},id:"close-modal","aria-hidden":"true"},"×"))),n.createElement("div",{className:"custom-modal-body"},n.createElement("div",{style:{position:"relative"}},h&&n.createElement("div",{className:"alert alert-danger"},n.createElement("small",null,h)),m&&n.createElement("div",{className:"alert alert-secondary"},"Loading..."),n.createElement("div",{className:"d-flex justify-content-center"},n.createElement("div",{style:{position:"relative"}},n.createElement("label",null,!1===a&&n.createElement("img",{className:"rounded-circle",id:"edit-profile-photo",style:{width:"14rem",height:"14rem"},src:`data: image/${u.profile_picture_format}; base64, ${u.profile_picture_data}`}),a&&n.createElement("img",{className:"rounded-circle",id:"edit-profile-photo",style:{width:"14rem",height:"14rem"},src:i}),n.createElement("input",{type:"file",accept:"image/*",onChange:function(e){e.target.files&&0!==e.target.files.length?r(e.target.files[0]):r(!1)}}),n.createElement("div",{className:"d-flex justify-content-center align-content-center"},n.createElement("div",{className:"edit-image-overlay rounded-circle",style:{backgroundColor:"rgba(0, 0, 0, 0.8)"}},n.createElement("div",{className:"w-100 h-100 d-flex justify-content-center align-items-center"},n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",style:{width:"10rem",height:"10rem"},width:"16",height:"16",fill:"white",className:"bi bi-images",viewBox:"0 0 16 16"},n.createElement("path",{d:"M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),n.createElement("path",{d:"M14.002 13a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V5A2 2 0 0 1 2 3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2zM14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1zM2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1h-10z"})))))))))),n.createElement("div",{className:"custom-modal-footer justify-content-center"},n.createElement("button",{id:"submit-data",className:"btn btn-primary",onClick:e=>{e.stopPropagation(),v(),async function(){d(!0);const e=(0,l.Xz)(i,"new-profile-picture"),t=e.type.match(/\/([a-zA-Z]+)/)[1],a=new FormData;a.append("profile_picture",e);const n=await(0,s.sZ)(a,t);n.error?(g("There was an error while submiting the new profile picture"),console.log(n.error),d(!1)):400===n.status?(g("File format or another factor is invalid for a picture, be sure to use any common picture extensions"),d(!1)):200===n.status?(E("Profile picture changed"),(0,l.tI)(),d(!1),w(),r(!1)):(g("There was an error when submiting the new profile picutre"),d(!1))}()}},"Save changes")))))}function c(){const[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)(null),[i,c]=(0,n.useState)(null),[m,d]=(0,n.useState)(null),[u,p]=(0,n.useState)(null),[h,g]=(0,n.useState)(!1),{user:E,contextLoading:w,modalErrorMessage:v,setErrorMessage:f,setModalErrorMessage:b,setSuccessMessage:y,resetApplicationMessages:N,retrieveUserData:C}=(0,o.Xn)(),[k,S]=(0,n.useState)(null);async function x(){g(!0);const e=document.getElementById("username-input").value,t=document.getElementById("password-username-input").value,a=await(0,s.Lv)(t,e);if(a.error)return b("There was an error while submiting the new username"),void g(!1);if(400===a.status){let e=a.newUsernameValid?"":"Username is not valid, make sure to only use numbers and letters\n";return e+=a.newUsernameUnique?"":"Username is already in use\n",e+=a.userCanChangeUsername?"":"You must wait 30 days in between switching usernames\n",e+=a.currentPasswordCorrect?"":"Password is incorrect\n",g(!1),void b(e)}if(200===a.status)return y("The new username has been saved"),g(!1),(0,l.tI)(),void C();b("There has been an error while submiting the new username"),g(!1)}return w?null:n.createElement("div",null,n.createElement("div",{className:"p-3 d-flex justify-content-center"},n.createElement("div",{className:"container"},n.createElement("strong",{style:{fontSize:"20px"}},"Username"),n.createElement("div",null,E.username)),n.createElement("button",{id:"username-button",className:"btn btn-outline-secondary rounded-15 align-self-center ml-auto",onClick:e=>(0,l.YK)("username-modal",e)},"Change"),n.createElement("div",{className:"custom-modal hidden",id:"username-modal",onClick:e=>{e.stopPropagation()}},n.createElement("div",{className:"custom-modal-header"},n.createElement("h5",null,"Change username"),n.createElement("button",{type:"button",className:"btn btn-link link-no-decorations ms-auto",id:"close-modal",onClick:e=>{(0,l.tI)(),N()}},n.createElement("span",{id:"close-modal","aria-hidden":"true"},"×"))),n.createElement("div",{className:"custom-modal-body"},v&&n.createElement("div",{className:"alert alert-danger",style:{whiteSpace:"pre-line"}},n.createElement("small",null,v)),!0===h&&n.createElement("div",{className:"alert alert-secondary"},n.createElement("div",{className:"d-flex justify-content-center align-items-center"},"Loading...")),n.createElement("input",{type:"password",placeholder:"Current password",className:"form-control",id:"password-username-input",onKeyUp:e=>(0,l.ac)(e,x)}),n.createElement("input",{type:"text",placeholder:"New username",className:"form-control mt-2",id:"username-input",onKeyUp:e=>(0,l.ac)(e,x)})),n.createElement("div",{className:"custom-modal-footer"},n.createElement("button",{id:"submit-data",className:"btn btn-primary mr-auto",onClick:e=>{e.stopPropagation(),N(),x()}},"Save changes")))))}function m(){const[e,t]=(0,n.useState)(null),{user:a,contextLoading:r,setModalErrorMessage:i,modalErrorMessage:c,setSuccessMessage:m,retrieveUserData:d,resetApplicationMessages:u}=(0,o.Xn)();async function p(){u(),t(!0);const e=document.getElementById("email-input").value,a=document.getElementById("password-email-input").value,n=await(0,s.Xc)(a,e);if(n.error)return i("There was an error while submiting the new email"),void t(!1);if(d(),200===n.status)return m("Email changed, check your inbox for the verification link"),(0,l.tI)(),void t(!1);let r=n.newEmailUnique?"":"Email is not unique\n";r+=n.newEmailValid?"":"Email is not valid\n",r+=n.currentPasswordCorrect?"":"Password is not correct\n",i(r),t(!1)}return r?null:n.createElement("div",null,n.createElement("div",{className:"p-3 d-flex justify-content-center"},n.createElement("div",{className:"container"},n.createElement("strong",{style:{fontSize:"20px"}},"Email"),n.createElement("div",null,a.email)),n.createElement("button",{id:"email-button",className:"btn btn-outline-secondary rounded-15 align-self-center ml-auto",onClick:e=>{(0,l.YK)("email-modal",e)}},"Change"),n.createElement("div",{className:"custom-modal hidden",id:"email-modal",onClick:e=>{e.stopPropagation()}},n.createElement("div",{className:"custom-modal-header"},n.createElement("h5",null,"Change email"),n.createElement("button",{type:"button",className:"btn btn-link link-no-decorations ms-auto",id:"close-modal",onClick:()=>{(0,l.tI)()}},n.createElement("span",{"aria-hidden":"true"},"×"))),n.createElement("div",{className:"custom-modal-body"},c&&n.createElement("div",{className:"alert alert-danger",style:{whiteSpace:"pre-line"}},c),!0===e&&n.createElement("div",{className:"alert alert-secondary"},n.createElement("div",{className:"d-flex justify-content-center align-items-center"},"Loading...")),n.createElement("input",{type:"password",placeholder:"Current password",className:"form-control",id:"password-email-input",onKeyUp:e=>(0,l.ac)(e,p)}),n.createElement("input",{type:"text",placeholder:"New email",className:"form-control mt-2",id:"email-input",onKeyUp:e=>(0,l.ac)(e,p)})),n.createElement("div",{className:"custom-modal-footer"},n.createElement("button",{id:"submit-data",className:"btn btn-primary mr-auto",onClick:e=>{e.stopPropagation(),p()}},"Save changes")))))}var d=a(974);function u(){const[e,t]=(0,n.useState)(null),{setLogout:a,retrieveUserData:r,contextLoading:i,modalErrorMessage:c,setModalErrorMessage:m,setSuccessMessage:u,resetApplicationMessages:p}=(0,o.Xn)();async function h(){t(!0);const e=document.getElementById("password-input").value,n=document.getElementById("password-password-input").value,r=await(0,d.gf)();let o;if(r.error)return m("There was an error while submiting the new password"),console.log(error),void t(!1);o=r.token;const i=await(0,s.sD)(o,n,e);if(i.error)return m("There was an error submiting the new password"),void t(!1);if(400===i.status){let e=i.newPasswordValid?"":"The password must be at least 8 characters and not easy to guess\n";return e+=i.currentPasswordCorrect?"":"The current password is not correct\n",m(e),void t(!1)}if(200===i.status)return t(!1),u("The new password has been saved, log into your account again"),(0,l.tI)(),void a();m("There was an error submiting the new password"),t(!1)}return i?null:n.createElement("div",null,n.createElement("div",{className:"p-3 d-flex justify-content-center"},n.createElement("div",{className:"container"},n.createElement("strong",{style:{fontSize:"20px"}},"Password"),n.createElement("div",null,"••••••••••")),n.createElement("button",{id:"password-button",className:"btn btn-outline-secondary rounded-15 align-self-center ml-auto",onClick:e=>{p(),(0,l.YK)("password-modal",e)}},"Change"),n.createElement("div",{className:"custom-modal hidden",id:"password-modal",onClick:e=>{e.stopPropagation()}},n.createElement("div",{className:"custom-modal-header"},n.createElement("h5",null,"Change password"),n.createElement("button",{type:"button",className:"ms-auto btn btn-link link-no-decorations",id:"close-modal",onClick:()=>{(0,l.tI)(),p()}},n.createElement("span",{"aria-hidden":"true"},"×"))),n.createElement("div",{className:"custom-modal-body"},c&&n.createElement("div",{className:"alert alert-danger",style:{whiteSpace:"pre-line"}},n.createElement("small",null,c)),!0===e&&n.createElement("div",{className:"alert alert-secondary"},n.createElement("div",{className:"d-flex justify-content-center align-items-center"},"Loading...")),n.createElement("input",{type:"password",placeholder:"Current password",className:"form-control",id:"password-password-input",onKeyUp:e=>(0,l.ac)(e,h)}),n.createElement("input",{type:"password",placeholder:"New password",className:"form-control mt-2",id:"password-input",onKeyUp:e=>(0,l.ac)(e,h)})),n.createElement("div",{className:"custom-modal-footer"},n.createElement("button",{id:"submit-data",className:"btn btn-primary mr-auto",onClick:e=>{e.stopPropagation(),p(),h()}},"Save changes")))))}function p(){const{user:e,userLoading:t,contextLoading:a}=(0,o.Xn)();return t?null:t||e.is_logged_in?n.createElement("div",null,n.createElement("div",{className:"card rounded-15 element-background-color element-border-color"},n.createElement(i,null),n.createElement("hr",null),n.createElement(c,null),n.createElement("hr",null),n.createElement(m,null),n.createElement("hr",null),n.createElement(u,null))):n.createElement("div",null,n.createElement(r.C5,{replace:!0,to:"/login"}))}}}]);